{% extends "layout.html" %}

{% block title %}Gestion des Applications{% endblock %}

{% block content %}
<h1 class="mb-4">Gestion des Applications</h1>

<div class="row">
    <div class="col-lg-6">
        <div class="card mb-4">
            <div class="card-header">Formulaire</div>
            <div class="card-body ">
        <form id="applicationForm">
            <input type="hidden" id="originalAppName" name="name">
            <input type="hidden" id="originalAppNamespace" name="namespace">

            <div class="card  p-3 mb-4 ">
                <h5 class="card-title">Général</h5>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="name" class="col-form-label">Nom :</label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="namespace" class="col-form-label">Namespace :</label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="namespace" name="namespace" required>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-8 offset-sm-4">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="active" name="active">
                            <label class="form-check-label" for="active">Active</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card  p-3 mb-4 ">
                <h5 class="card-title">Métadonnées</h5>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="base" class="col-form-label">Base :</label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="base" name="base" value="apps">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-8 offset-sm-4">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="prune" name="prune">
                            <label class="form-check-label" for="prune">Prune</label>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="retryInterval" class="col-form-label">Retry Interval :</label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="retryInterval" name="retryInterval">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="timeout" class="col-form-label">Timeout :</label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="timeout" name="timeout">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="interval" class="col-form-label">Interval :</label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="interval" name="interval">
                    </div>
                </div>
            </div>

            <div class="card  p-3 mb-4 ">
                <h5 class="card-title">Ingress</h5>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="ingressClassName" class="col-form-label">className :</label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="ingressClassName" name="ingressClassName">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="ingressSectionPath" class="col-form-label">section_path :</label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="ingressSectionPath" name="ingressSectionPath">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="ingressHelmreleaseFile" class="col-form-label">helmrelease_file :</label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="ingressHelmreleaseFile" name="ingressHelmreleaseFile">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-8 offset-sm-4">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="ingressActive" name="ingressActive">
                            <label class="form-check-label" for="ingressActive">Active</label>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="ingressAnnotationsKeys" class="col-form-label">Annotations :</label>
                    </div>
                    <div class="col-sm-8">
                        <select class="form-select" id="ingressAnnotationsKeys" multiple>
                            {% for annotation in ingress_annotations %}
                                <option value="{{ annotation.nom }}">{{ annotation.nom }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row mb-3" id="ingressAnnotationsValuesContainer">
                    </div>
            </div>

            <div class="card  p-3 mb-4 ">
                <h5 class="card-title">Helm</h5>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="helmName" class="col-form-label">Nom :</label>
                    </div>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="helmName" name="helmName">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-8 offset-sm-4">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="helmHealthChecks" name="helmHealthChecks">
                            <label class="form-check-label" for="helmHealthChecks">Health Checks</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card  p-3 mb-4 ">
                <h5 class="card-title">Substituts</h5>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="substitutesKeys" class="col-form-label">Clés :</label>
                    </div>
                    <div class="col-sm-8">
                        <select class="form-select" id="substitutesKeys" multiple>
                            {% for substitute in substitutes %}
                                <option value="{{ substitute.nom }}">{{ substitute.nom }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row mb-3" id="substitutesValuesContainer">
                    </div>
            </div>

            <div class="card  p-3 mb-4 ">
                <h5 class="card-title">Composants et Dépendances</h5>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="components" class="col-form-label">Components :</label>
                    </div>
                    <div class="col-sm-8">
                        <select class="form-select" id="components" name="components" multiple>
                            {% for component in components %}
                                <option value="{{ component.nom }}">{{ component.nom }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4 d-flex align-items-center">
                        <label for="dependsOn" class="col-form-label">Dépendances :</label>
                    </div>
                    <div class="col-sm-8">
                        <select class="form-select" id="dependsOn" name="dependsOn" multiple>
                            {% for app in applications %}
                                <option value="{{ app.name }}:{{ app.namespace }}">
                                    {{ app.name }} ({{ app.namespace }})
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-sm-8 offset-sm-4">
                    <button type="submit" id="submitBtn" class="btn btn-primary">Ajouter</button>
                    <button type="button" id="cancelBtn" class="btn btn-secondary" style="display: none;">Annuler</button>
                </div>
            </div>
        </form>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card mb-4">
            <div class="card-header">Graphe des Dépendances</div>
            <div class="card-body ">
                <div class="row mb-3 align-items-center">
                    <div class="col-md-6">
                        <label for="dependencyDepth" class="form-label mb-0">Niveau de dépendance :</label>
                    </div>
                    <div class="col-md-6">
                        <select class="form-select" id="dependencyDepth">
                            <option value="1">1 niveau</option>
                            <option value="2" selected>2 niveaux</option>
                            <option value="3">3 niveaux</option>
                            <option value="all">Tout</option>
                        </select>
                    </div>
                </div>
                <div id="dependencyGraphContainer" class="row mt-3" style="width: 100%; height: 600px;">
                    <svg id="dependencyGraph"></svg>
                </div>
            </div>
        </div>
    </div>
</div>
</div>


<h1 class="mb-4">Liste des applications</h1>

<div class="card mb-4">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover" id="applicationsTable">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Namespace</th>
                        <th>Base</th>
                        <th>Active</th>
                        <th>Dépendances</th>
                        <th>Actions</th>
                    </tr>
                    <tr>
                        <td><input type="text" id="filter-name" class="form-control form-control-sm" placeholder="Filtrer le nom..."></td>
                        <td>
                            <select id="filter-namespace" class="form-select form-select-sm">
                                <option value="">Tous les namespaces</option>
                            </select>
                        </td>
                        <td>
                            <select id="filter-base" class="form-select form-select-sm">
                                <option value="">Toutes les Bases</option>
                            </select>
                        </td>
                        <td>
                            <select id="filter-active" class="form-select form-select-sm">
                                <option value="">Toutes</option>
                                <option value="true">Oui</option>
                                <option value="false">Non</option>
                            </select>
                        </td>
                        <td><input type="text" id="filter-dependencies" class="form-control form-control-sm" placeholder="Filtrer les dépendances..."></td>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5">
                            <div id="loadingSpinner" class="d-flex justify-content-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Chargement...</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/apps/applications.js') }}"></script>
{% endblock %}